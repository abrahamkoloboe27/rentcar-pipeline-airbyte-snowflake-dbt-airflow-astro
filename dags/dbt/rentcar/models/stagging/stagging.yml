version: 2

models:
  - name: stg_cities
    description: "Table de staging pour les villes"
    config:
      materialized: table
      unique_key: city_id
      schema: stg
    columns:
      - name: city_id
        description: "Identifiant unique de la ville"
        tests:
          - unique
      - name: city_name
        description: "Nom de la ville"
        tests:
          - not_null
      - name: country_id
        description: "Identifiant unique du pays"
        tests:
          - not_null
      - name: latitude
        description: "Coordonnée géographique de latitude"
        tests:
          - not_null
      - name: longitude
        description: "Coordonnée géographique de longitude"
        tests:
          - not_null

  - name: stg_countries
    description: "Table de staging pour les pays"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique du pays"
        tests:
          - unique
      - name: name
        description: "Nom du pays"
        tests:
          - not_null
      - name: isoCode
        description: "Code ISO du pays"
        tests:
          - not_null
          - unique
      - name: currency
        description: "Devise utilisée dans le pays"
        tests:
          - not_null
          - accepted_values:
              values: ["XOF","NGN","KES","GHS","XAF","CDF","SLL"]
      - name: locale
        description: "Paramètres régionaux du pays"
  
  - name: stg_drivers
    description: "Table de staging pour les conducteurs"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique du conducteur"
        tests:
          - unique
          - not_null
      - name: userId
        description: "Identifiant utilisateur associé au conducteur"
        tests:
          - not_null
      - name: cityid
        description: "Identifiant de la ville où opère le conducteur"
        tests:
          - not_null
      - name: joined_dt
        description: "Horodatage de l'inscription du conducteur sur la plateforme"
      - name: fullname
        description: "Nom complet du conducteur"
      - name: phonenumber
        description: "Numéro de téléphone du conducteur"
      - name: licenseNumber
        description: "Numéro de permis de conduire"
        tests:
          - not_null
      - name: status
        description: "Statut actuel du conducteur"
        tests:
          - accepted_values:
              values: ["active","inactive","suspended","banned"]

  - name: stg_maintenance
    description: "Table de staging pour les enregistrements de maintenance"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique de l'enregistrement de maintenance"
        tests:
          - unique
          - not_null
      - name: vehicleId
        description: "Identifiant du véhicule en maintenance"
        tests:
          - not_null
      - name: type
        description: "Type de maintenance effectuée"
        tests:
          - accepted_values:
              values: ["repair","routine_check","replacement"]
      - name: description
        description: "Description détaillée des travaux de maintenance"
      - name: reported_dt
        description: "Horodatage de la déclaration de maintenance"
      - name: started_dt
        description: "Horodatage du début des travaux de maintenance"
      - name: ended_dt
        description: "Horodatage de la fin des travaux de maintenance"
      - name: cost
        description: "Coût des travaux de maintenance"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              #max_value: 1000000

  - name: stg_ratings
    description: "Table de staging pour les évaluations"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique de l'évaluation"
        tests:
          - unique
          - not_null
      - name: tripid
        description: "Identifiant du trajet associé"
        tests:
          - not_null
      - name: toid
        description: "Identifiant de l'entité évaluée"
        tests:
          - not_null
      - name: stars
        description: "Note attribuée"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0.0
              max_value: 5.0
      - name: comment
        description: "Commentaire textuel de l'évaluation"
      - name: givenby
        description: "Nom de la personne ayant attribué l'évaluation"
        tests:
          - not_null
          - accepted_values:
              values: ["user","driver"]
      - name: givenbyid
        description: "Identifiant de la personne ayant attribué l'évaluation"
      - name: totype
        description: "Type d'entité évaluée"
        tests:
          - not_null
          - accepted_values:
              values: ["user","driver"]
      - name: created_dt
        description: "Horodatage de création de l'évaluation"

  - name: stg_trips
    description: "Table de staging pour les trajets"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique du trajet"
        tests:
          - unique
          - not_null
      - name: serviceType
        description: "Type de service demandé"
        tests:
          - not_null
          - accepted_values:
              values: ["ride","delivery","rental"]
      - name: userId
        description: "Identifiant de l'utilisateur ayant demandé le trajet"
        tests:
          - not_null
      - name: driverId
        description: "Identifiant du conducteur affecté au trajet"
        tests:
          - not_null
      - name: vehicleId
        description: "Identifiant du véhicule utilisé pour le trajet"
        tests:
          - not_null
      - name: origin
        description: "Point de départ du trajet"
        tests:
          - not_null
      - name: destination
        description: "Destination du trajet"
        tests:
          - not_null
      - name: requested_dt
        description: "Horodatage de la demande de trajet"
      - name: accepted_dt
        description: "Horodatage de l'acceptation du trajet par le conducteur"
      - name: started_dt
        description: "Horodatage du début du trajet"
      - name: ended_dt
        description: "Horodatage de la fin du trajet"
      - name: status
        description: "Statut actuel du trajet"
        tests: 
          - not_null
          - accepted_values:
              values: ["requested", "ongoing", "completed", "cancelled"]
      - name: amount
        description: "Montant total facturé pour le trajet"
        tests:
          - not_null
          #- numeric
          - dbt_utils.accepted_range:
              min_value: 0.0
              max_value: 1000000
      - name: fare
        description: "Tarif de base du trajet"
        tests:
          - not_null
          # #- numeric
          # - dbt_utils.expression_is_true:
          #       expression: >
          #           fare >= 0
          #           AND fare <= 1000000

      - name: serviceDetails
        description: "Détails supplémentaires sur le service"
      - name: currency
        description: "Devise utilisée pour le paiement"
        tests:
          - not_null
          - accepted_values:
              values: ["XOF","NGN","KES","GHS","XAF","CDF","SLL"]

  - name: stg_users
    description: "Table de staging pour les utilisateurs"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique de l'utilisateur"
      - name: fullname
        description: "Nom complet de l'utilisateur"
      - name: email
        description: "Adresse e-mail de l'utilisateur"
      - name: phonenumber
        description: "Numéro de téléphone de l'utilisateur"
      - name: cityid
        description: "Identifiant de la ville où se trouve l'utilisateur"
      - name: signup_dt
        description: "Horodatage de l'inscription de l'utilisateur"
      - name: countryid
        description: "Identifiant du pays de l'utilisateur"

  - name: stg_vehicles
    description: "Table de staging pour les véhicules"
    config:
      materialized: table
      unique_key: _id
      schema: stg
    columns:
      - name: _id
        description: "Identifiant unique du véhicule"
      - name: driverId
        description: "Identifiant du conducteur affecté au véhicule"
      - name: brand
        description: "Marque/fabricant du véhicule"
      - name: model
        description: "Modèle du véhicule"
      - name: licenseplate
        description: "Numéro de plaque d'immatriculation du véhicule"
      - name: mileagekm
        description: "Kilométrage total du véhicule en kilomètres"
      - name: status
        description: "Statut actuel du véhicule"
      - name: year
        description: "Année de fabrication du véhicule"
      - name: type
        description: "Type/catégorie du véhicule"
      - name: acquisitiondate
        description: "Date d'acquisition du véhicule"
